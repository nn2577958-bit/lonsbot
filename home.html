<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LONS Palworld Home</title>
<link rel="icon" href="https://cdn.phototourl.com/uploads/2026-02-16-2fc87bae-3744-4c0a-891f-19f3a20b09fd.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#111; color:white; }
.topbar{ display:flex; justify-content:space-between; align-items:center; padding:15px 25px; background:#000; border-bottom:1px solid #333; }
.topbar-left{ font-size:20px; font-weight:bold; }
.topbar-right{ display:flex; align-items:center; gap:15px; }
.top-btn{ padding:6px 14px; border-radius:20px; border:none; cursor:pointer; font-size:14px; font-weight:600; }
#admin-status{ padding:6px 14px; border-radius:20px; background:#444; }
.pay-btn{ background:#FFDC00; color:#000; }
.discord-btn{ background:#5865F2; color:#fff; }
.logout-btn{ background:#f44336; color:#fff; }
.notice-section{ padding:40px; }
.notice-section h2{ font-size:26px; margin-bottom:20px; }
.notice-list{ display:flex; flex-direction:column; gap:15px; }
.notice-item{ background:#1c1c1c; padding:20px; border-radius:12px; border-left:5px solid #4CAF50; }
.notice-item strong{ font-size:18px; }
.notice-item small{ display:block; color:#aaa; margin:5px 0; }
.modal{ display:none; position:fixed; top:0;left:0; width:100%;height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
.modal-content{ background:white; color:black; padding:25px; border-radius:12px; text-align:center; width:300px; }
.modal-content button{ margin-top:15px; padding:8px 15px; border:none; background:#333; color:white; border-radius:8px; }
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-left">ğŸ® LONS Palworld</div>
  <div class="topbar-right">
    <div id="admin-status">í™•ì¸ì¤‘...</div>
    <button class="top-btn pay-btn" id="kakao-btn">ğŸ’› Pay ì§€ì›ê¸ˆ</button>
    <button class="top-btn discord-btn" id="discord-btn">
      <i class="fab fa-discord"></i> Discord
    </button>
    <button class="top-btn logout-btn" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</div>

<div class="notice-section">
  <h2>ğŸ“¢ ê³µì§€ì‚¬í•­</h2>
  <div class="notice-list" id="notice-list"></div>
</div>

<div class="modal" id="pc-modal">
  <div class="modal-content">
    <h3>ğŸ“± ëª¨ë°”ì¼ ì „ìš©</h3>
    <p>ì¹´ì¹´ì˜¤í˜ì´ëŠ” ëª¨ë°”ì¼ì—ì„œ ì´ìš©í•´ì£¼ì„¸ìš”.</p>
    <button onclick="closeModal()">ë‹«ê¸°</button>
  </div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { collection, doc, getDocs, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const ADMIN_EMAIL = "ê´€ë¦¬ìì´ë©”ì¼@gmail.com";
const adminStatus = document.getElementById("admin-status");
const noticeList = document.getElementById("notice-list");
const kakaoBtn = document.getElementById("kakao-btn");
const discordBtn = document.getElementById("discord-btn");
const logoutBtn = document.getElementById("logout-btn");
const modal = document.getElementById("pc-modal");

onAuthStateChanged(auth, async(user) => {
  if (!user) { window.location.href = "index.html"; return; }

  // ê´€ë¦¬ìë¼ë©´ Firestoreì— ì˜¨ë¼ì¸ ìƒíƒœ ê¸°ë¡
  const adminDocRef = doc(db, "adminStatus/current");
  if (user.email === ADMIN_EMAIL) {
    await setDoc(adminDocRef, { online: true, lastLogin: Date.now() });
  }

  // ì‹¤ì‹œê°„ ê´€ë¦¬ì ìƒíƒœ ê°ì‹œ
  onSnapshot(adminDocRef, (docSnap) => {
    if (docSnap.exists()) {
      const data = docSnap.data();
      if (data.online) {
        adminStatus.innerHTML = "ğŸŸ¢ ê´€ë¦¬ì ì˜¨ë¼ì¸";
        adminStatus.style.background = "#28a745";
      } else {
        adminStatus.innerHTML = "ğŸ”´ ê´€ë¦¬ì ì˜¤í”„ë¼ì¸";
        adminStatus.style.background = "#dc3545";
      }
    }
  });

  // ê³µì§€ì‚¬í•­ ì‹¤ì‹œê°„ ë¶ˆëŸ¬ì˜¤ê¸°
  const noticesRef = collection(db, "notices");
  onSnapshot(noticesRef, (snapshot) => {
    noticeList.innerHTML = "";
    snapshot.docs.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "notice-item";
      div.innerHTML = `
        <strong>${data.title}</strong>
        <small>${data.createdAt}</small>
        <div>${data.content}</div>
      `;
      noticeList.appendChild(div);
    });
  });
});

logoutBtn.onclick = async () => {
  const user = auth.currentUser;
  if (user && user.email === ADMIN_EMAIL) {
    const adminDocRef = doc(db, "adminStatus/current");
    await setDoc(adminDocRef, { online: false, lastLogout: Date.now() });
  }
  await signOut(auth);
  window.location.href = "index.html";
};

discordBtn.onclick = () => window.open("https://discord.gg/tnMXbQ65Hk","_blank");

kakaoBtn.onclick = () => {
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if (isMobile) window.location.href = "https://qr.kakaopay.com/FRydbZ6Gr";
  else modal.style.display = "flex";
};

window.closeModal = () => modal.style.display = "none";
</script>
</body>
</html>
