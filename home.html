<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palworld ëŒ€ì‹œë³´ë“œ</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  background: rgba(0,0,0,0.75);
  padding: 35px;
  border-radius: 20px;
  width: 95%;
  max-width: 650px;
}

.box {
  background: rgba(255,255,255,0.1);
  padding: 15px;
  border-radius: 10px;
  margin-top: 15px;
}

.notice {
  border-bottom: 1px solid rgba(255,255,255,0.2);
  padding: 8px 0;
}

.logout-btn {
  margin-top: 20px;
  padding: 10px 20px;
  background: #ff4d4d;
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
}

.admin-box {
  display: none;
  background: rgba(255,0,0,0.2);
}
</style>
</head>

<body>

<div class="container">

  <h2>ğŸ® Palworld í†µí•© ëŒ€ì‹œë³´ë“œ</h2>

  <div class="box">
    <p>ì´ë©”ì¼: <strong id="user-email"></strong></p>
    <p>ë‹‰ë„¤ì„: <span id="user-nickname"></span></p>
    <p>ì—­í• : <span id="user-role"></span></p>
  </div>

  <div class="box">
    <h3>ğŸ–¥ ì„œë²„ ìƒíƒœ</h3>
    <p>ìƒíƒœ: <span id="server-status">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
    <p>í˜„ì¬ ì ‘ì†ì: <span id="online-users">-</span></p>
    <p id="server-message"></p>
  </div>

  <div class="box">
    <h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
    <div id="notice-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <div class="box admin-box" id="admin-panel">
    <h3>ğŸ›  ê´€ë¦¬ì ì „ìš©</h3>
    <p>ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ë¨</p>
  </div>

  <button id="logout-btn" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { 
  getFirestore, 
  doc, 
  getDoc,
  collection,
  getDocs,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCyiAepd539cBTPwtcVnAR-HJbb8roLJmE",
  authDomain: "lons-dc24d.firebaseapp.com",
  projectId: "lons-dc24d",
  storageBucket: "lons-dc24d.appspot.com",
  messagingSenderId: "755692328918",
  appId: "1:755692328918:web:a4eb4563cb862d3eb5b677"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {

  if (!user) {
    window.location.href = "index.html";
    return;
  }

  document.getElementById("user-email").textContent = user.email;

  // ğŸ”¥ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
  const userSnap = await getDoc(doc(db, "users", user.uid));
  if (userSnap.exists()) {
    const data = userSnap.data();
    document.getElementById("user-nickname").textContent = data.nickname || "-";
    document.getElementById("user-role").textContent = data.role || "user";

    if (data.role === "admin") {
      document.getElementById("admin-panel").style.display = "block";
    }
  }

  // ğŸ”¥ ì„œë²„ ìƒíƒœ ì‹¤ì‹œê°„ ê°ì§€
  onSnapshot(doc(db, "server", "status"), (snap) => {
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("server-status").textContent = data.status;
      document.getElementById("online-users").textContent = data.onlineUsers;
      document.getElementById("server-message").textContent = data.message;
    }
  });

  // ğŸ”¥ ê³µì§€ì‚¬í•­ ë¶ˆëŸ¬ì˜¤ê¸°
  const noticeList = document.getElementById("notice-list");
  noticeList.innerHTML = "";

  const querySnapshot = await getDocs(collection(db, "notices"));

  querySnapshot.forEach(doc => {
    const data = doc.data();
    noticeList.innerHTML += `
      <div class="notice">
        <strong>${data.title}</strong>
        <div>${data.content}</div>
      </div>
    `;
  });

});

document.getElementById("logout-btn").addEventListener("click", () => {
  signOut(auth).then(() => {
    window.location.href = "index.html";
  });
});
</script>

</body>
</html>
